<div *ngIf="status!=null">
  <div class="d-flex justify-content-center my-3">
    <div class="alert alert-danger" role="alert">
      {{status!.error.message}} - {{status!.message}}
    </div>
  </div>
</div>

<div *ngIf="status==null">
  <div class="flex justify-content-between mb-3">
    <h3 *ngIf="id_user>0">Filtered by user ({{id_user}} - {{oUser?.name}} {{oUser?.surname}}) 
      <a type="button" class="btn btn-danger btn-sm" *ngIf="id_user>0" [routerLink]="['/admin','user','plist']">reset filter</a>
    </h3>

    <h3 *ngIf="!(id_user>0)">No active filter</h3>

    <h3>Showing {{oPage?.numberOfElements}} of total {{oPage?.totalElements}} Books.</h3>
  </div>
  


  <div class="relative overflow-x-auto shadow-md sm:rounded-lg ">
    <table class=" text-center w-full text-sm text-left rtl:text-right font-medium  bg-slate-700  rounded-lg">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th class="px-6 py-3" (click)="doOrder('id')">ID</th>
          <th class="px-6 py-3" (click)="doOrder('title')">Title</th>
          <th class="px-6 py-3" (click)="doOrder('author')">Author</th>
          <th class="px-6 py-3" (click)="doOrder('category')">Category</th>
          <th class="px-6 py-3" (click)="doOrder('available')">Available</th>
          <th class="px-6 py-3" (click)="doOrder('ownerUser')">Owner User</th>
          <th class="px-6 py-3">Number of loans</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let b of oPage?.content" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600" >
          <!--ID -->
          <td class="px-4 pt-3font-medium  dark:text-white whitespace-nowrap dark:text-white">{{b.id}}</td>
          <!--Title -->
          <td class="px-4 pt-3 dark:text-white">{{b.title}}</td>
          <!--Author -->
          <td class="px-4 pt-3 dark:text-white">{{b.author}}</td>
          <!--Category -->
          <td class="px-4 pt-3 dark:text-white">{{b.category}}</td>
          <!--Avalaible -->
          <td class="px-4 pt-3 dark:text-white">
            <span *ngIf="b.available" class="text-green-600">AVAILABLE</span>
            <span *ngIf="!b.available" class="text-red-600">LOANED</span>
          </td>
          <!--Owner User -->
          <td class="px-4 pt-3 dark:text-white">
            <a  *ngIf="b.ownerUser != null" [routerLink]="['/admin','book','plist','byuser',b.ownerUser.id]">({{b.ownerUser.id}}) {{b.ownerUser.username}} </a>
          </td>
          <!--Number of loans -->
          <td class="px-4 pt-3  dark:text-white text-center  underline">
            <a [routerLink]="['/admin','reply','plist','bybook',b.id]" *ngIf="b.loans>0">{{b.loans}}</a>
            <span *ngIf="b.loans==0" class="dark:text-white ">0</span>
          </td>
          <!--Tools -->
          <td class="inline-flex px-4 py-3 gap-2 text-white" role="group">
              <button class="bg-blue-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" [routerLink]="['/admin','book','view',b.id]"><mat-icon>remove_red_eye</mat-icon></button>
              <button class="bg-green-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" (click)="doView(b)"><mat-icon>assignment_ind</mat-icon></button>
              <button class="bg-yellow-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" [routerLink]="['/admin','book','edit',b.id]"><mat-icon>edit</mat-icon></button>
              <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" *ngIf="b.loans==0" (click)="doRemove(b)"><mat-icon>delete_forever</mat-icon></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div>
    <p-paginator (onPageChange)="onPageChang($event)" [first]="oPaginatorState.first!" [rows]="oPaginatorState.rows!"
      [totalRecords]="oPage?.totalElements || 0" [rowsPerPageOptions]="[10, 20, 30]"></p-paginator>
  </div>
</div>




<p-confirmDialog #cd [style]="{ width: '30vw' }">
  <ng-template pTemplate="header">
    <h5 class="text-2xl font-bold"><i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i> Book Removal</h5>
  </ng-template>
  <ng-template pTemplate="message">
    <div class="container flex items-center justify-center">
      <app-admin-book-detail-unrouted [id]="oBookToRemove!.id"></app-admin-book-detail-unrouted>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <p class="mb-4">Are you sure to remove the book?</p>
    <button class="bg-blue-500 text-white px-4 py-2 rounded mr-2" pButton icon="pi pi-times" (click)="cd.reject()">No</button>
    <button class="bg-red-500 text-white px-4 py-2 rounded" pButton icon="pi pi-check" (click)="cd.accept()">Yes</button>
  </ng-template>
</p-confirmDialog>
